(()=>{"use strict";var e={958:e=>{var t={isMobile:e=>{const{type:t}=e;return"mobile"===t.slice(0,6)}};const{isMobile:r}=t;var n={getFieldElement:(e,t)=>r(e)?kintone.mobile.app.record.getFieldElement(t):kintone.app.record.getFieldElement(t),getFieldElements:(e,t)=>r(e)?kintone.mobile.app.getFieldElements(t):kintone.app.getFieldElements(t)};const{isMobile:o}=t,{isMobile:a}=t,{getFieldElement:i,getFieldElements:c}=n;var d={isMobile:a,getFieldElement:i,getFieldElements:c,getSpaceElement:(e,t)=>o(e)?kintone.mobile.app.record.getSpaceElement(t):kintone.app.record.getSpaceElement(t),getDateString:(e,t=new Date)=>{const r=t.getFullYear().toString(),n=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");let a;switch(e){case"yyyymmdd":default:a=`${r}${n}${o}`;break;case"yymmdd":a=`${r.slice(2,4)}${n}${o}`;break;case"yyyy-mm-dd":a=`${r}-${n}-${o}`;break;case"yyyymm":a=`${r}${n}`;break;case"yymm":a=`${r.slice(2,4)}${n}`}return a}};e.exports=d}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}(()=>{var e=r(958);const t="商品型號",n="訂單明細",o="訂單明細商品名稱",a="訂單明細商品型號",i="訂單明細單價",c="訂單明細數量",d="訂單明細金額小計",s=["app.record.create.show","app.record.edit.show","mobile.app.record.create.show","mobile.app.record.edit.show"],l=r=>{try{kintone.app.record.setFieldShown(t,!1),kintone.mobile.app.record.setFieldShown(t,!1);const s=(0,e.getSpaceElement)(r,"add-btn"),l=new Kuc.Button({text:"Add",type:"submit",id:"add-button"});return s.appendChild(l),l.addEventListener("click",(e=>{const r=kintone.app.record.get().record,s=r[t],l=r["商品名稱"],p=r["商品售價"],u=r["數量"];if(!s.value||!l.value||!p.value){const e="請輸入商品資訊";throw new Kuc.Notification({text:e,type:"danger",duration:2e3}).open(),new Error(e)}if(!u.value){const e="請輸入數量";throw new Kuc.Notification({text:e,type:"danger",duration:2e3}).open(),new Error(e)}const m={value:{}};m.value[a]=s,m.value[o]=l,m.value[i]=p,m.value[c]=u,m.value[d]={type:"CALC",value:Number(p.value)*Number(u.value)},r[n].value[0].value[a].value||r[n].value.shift(),r[n].value.push(m),kintone.app.record.set({record:r})})),r}catch(e){return console.err(e),r}},p="訂單編號",u="建立時間",m=["app.record.create.submit","mobile.record.create.submit"],w=async t=>{const r=(t=>{const r=(0,e.getDateString)();return t?`${r}-${(Number(t[p].value.slice(9,15))+1).toString().padStart(6,"0")}`:`${r}-000001`})(await(async()=>{try{const e=new Date,t=new Date(e.setHours(0,0,0,0)).toISOString(),r=new Date(e.setHours(24,0,0,0)).toISOString(),n=`\n        ${u} >= "${t}" and ${u} < "${r}"\n        order by ${u} desc limit 1\n      `,o=kintone.api.url("/k/v1/records");console.log(o);const a={app:49,query:n};return(await kintone.api(o,"GET",a)).records[0]||null}catch(e){console.log(e)}})());return t.record[p].value=r,t},g=["app.record.create.show","app.record.edit.show","app.record.index.edit.show","mobile.app.record.create.show","mobile.app.record.edit.show"],v=e=>(["訂單編號"].forEach((t=>{e.record[t].disabled=!0})),e),y=["商品名稱","商品型號","商品售價","數量"],h=["app.record.detail.show","mobile.app.record.detail.show"],b=e=>(y.forEach((e=>{kintone.app.record.setFieldShown(e,!1),kintone.mobile.app.record.setFieldShown(e,!1)})),e),k=async e=>{try{const t=kintone.api.url("/k/v1/records"),r=await kintone.api(t,"GET",e),{records:n}=r;return n}catch(e){console.error(e)}},E=(e,t)=>{if(!t)throw new Error('getFieldValueArray: params "fieldCode" is required');if(!e||0===e.length)throw new Error('getFieldValueArray: params "records" cannot be an empty array');return e.map((e=>e[t].value))},$=(e,t="Dropdown")=>({label:t,items:e.map((e=>({label:e,value:e})))}),S="商品系列",F="商品型號",f="商品名稱",D={series:{app:50,query:`\n      啟用狀態 in ("啟用")\n      order by ${S} asc\n    `},product:{app:48}},x=["app.record.create.show","app.record.edit.show"],M=async t=>{try{const r=await k(D.series),n=E(r,S),o=$(n,"選擇商品系列"),a=new Kuc.Dropdown(o),i=(0,e.getSpaceElement)(t,"product-series"),c=(0,e.getSpaceElement)(t,"product-id");return i.appendChild(a),a.addEventListener("change",(async e=>{const t=e.target.value;D.product.query=`\n          ${S} in ("${t}")\n          order by ${F} asc\n        `;const r=await k(D.product),n=E(r,F),o=$(n,"選擇商品型號"),a=new Kuc.Dropdown(o);c.innerHTML="",c.appendChild(a),a.addEventListener("change",(async e=>{const t=e.target.value;D.product.query=`\n            ${F} = "${t}"\n          `;const r=(await k(D.product))[0][f].value,n=kintone.app.record.get();n.record[f].value=r,n.record[f].lookup=!0,kintone.app.record.set(n)}))})),t}catch(e){return console.error(e),t.error="Something wrong!",t}};Kucs["1.17.0"],kintone.events.on(g,v),kintone.events.on(x,M),kintone.events.on(s,l),kintone.events.on(h,b),kintone.events.on(m,w)})()})();